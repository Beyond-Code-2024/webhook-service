# Webhook Service
---

Webhooks management service which other services can use to register and forget complexity of delivering webhooks to endpoints.


## Tech Stack
NestJs, Kafka, MongoDB, Redis



## Low level Design
below is the current schema design to be implemented.

### Entities
**Organisation:**
- organisation Details.
- organisation can register services under it.
- we can enable or disable the organisation.

schema:
```TS
interface Organisation {
    name: string;
    displayName: string;
    email: string;
    password: string;
    planType: 'BASIC' | 'PRO' | 'ENTERPRISE';
}
```

**Service:**
- services Details.
- services will register endpoints and send event webhooks.
- can be enabled or disabled.
- we can define events under a service.


schema:
```TS
interface Service {
    organisationId: string;
    events: string[];
    name: string;
    apiKey: string;
    apiSecret: string;
    enabled: boolean;
}
```

**Endpoint:**
- services will create endpoints.
- will have endpoint details.

Schema:
```TS
interface Comment {
    type: 'AUTOMATIC' | 'MANUAL',
    reason: string;
}

 interface Endpoint {
    serviceId: string;
    name: string;
    endpoint: string;
    events: Event[];
    active: boolean;
    comments: Comment[]; // userful for tracking why we disabled
    createdAt: Date
    updatedAt: Date
}
```

**Events:**
- has all the events metadata that are registered with a service
- service to events will be a one to many relationship.

Schema:
```TS
interface Event {
    serviceId: string;
    name: string;
    description: string;
    active: boolean;
    createdAt: Date;
    updatedAt: Date;
}
```


**EventLogs:**
- keeps status, retryCount and logs of the responses given by the customer. endpoints.

Schema:
```TS
interface Log {
    requestTime: Date;
    endpointResponse: object | null;
    endpointResponseStatus: string; // HTTP status code.
}

interface EventLogs {
    serviceId: string;
    endpointId: string;
    event: Event;
    event_id: string; // generated by us.
    status: 'QUEUED' | 'DELIVERED' | 'FAILED';
    payload: string;
    retryCount: string;
    logs: Log[];
    idempotency: {
        key: string; // to be sent by client service.
        ttl: number; // number of seconds to keep the idempotency key active.
    }
    createdAt: string;
    updatedAt: string;
}
```


## RoadMap
- [ ] introduce organisations APIs.
    - [x] register organisation
    - [x] login
    - [ ] change password
    - [ ] email verification
- [ ] introduce service APIs
     - [ ] register service API endpoint
     - [ ] update service details
     - [ ] re-generate service credentials
     - [ ] add events for a service
     - [ ] enable disable service
- [ ] introduce endpoint APIs
     - [ ] create endpoint
     - [ ] update endpoint
     - [ ] assign which events can be sent
     - [ ] activate deactivate endpoint

<!-- TODO: fill up the subtasks -->
- [ ] mark an endpoint as faulty endpoint.
- [ ] introduce event APIs
    - [ ] add events API
    - [ ] update events API
- [ ] introduce sendWebhook API for services to call.
- [ ] introduce Redis for idempotency locks.
- [ ] introduce rate limiting for service level API calls.
- [ ] analytics
- [ ] alerting clients(organisations) about any delivery failures.